<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LCM - Laboratório de Ciências Militares | ECEME</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <style>
        :root { --eb-green: #1e3a2c; --eb-gold: #c5a059; --eb-gold-light: #d4b781; }
        .bg-eb-green { background-color: var(--eb-green); }
        .text-eb-green { color: var(--eb-green); }
        .text-eb-gold { color: var(--eb-gold); }
        .border-eb-green { border-color: var(--eb-green); }
        .border-eb-gold { border-color: var(--eb-gold); }
        .hover-gold:hover { color: var(--eb-gold-light); }
        body { font-family: 'Georgia', serif; }
        [x-cloak] { display: none !important; }
        .tab-active { border-bottom: 4px solid var(--eb-gold); color: var(--eb-green); font-weight: bold; background-color: #f9fafb; }
        .map-container iframe { width: 100%; height: 100%; min-height: 300px; border: 0; }
    </style>
</head>

<body class="bg-gray-50 text-gray-900 flex flex-col min-h-screen" x-data="appData()" x-init="initApp()">

    <nav class="bg-eb-green text-white border-b-2 border-eb-gold sticky top-0 z-50 shadow-xl">
        <div class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4 cursor-pointer" @click="view = 'home'">
                    <img src="brasao-lcm.png" alt="LCM" class="h-12 w-auto bg-white rounded-full p-0.5 object-contain">
                    <div class="hidden md:block leading-tight">
                        <h1 class="font-bold text-sm uppercase tracking-wide" x-text="t[lang].header_lcm_full"></h1>
                        <p class="text-[10px] tracking-widest text-eb-gold uppercase" x-text="t[lang].header_eceme_full"></p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="relative hidden md:block">
                        <input type="text" x-model="searchQuery" :placeholder="t[lang].search_placeholder" class="bg-green-900 text-white text-sm rounded-full px-4 py-1.5 focus:outline-none focus:ring-1 focus:ring-eb-gold w-48 border border-green-800">
                        <i class="fa-solid fa-magnifying-glass absolute right-3 top-2 text-gray-400 text-xs"></i>
                        <div x-show="searchQuery.length > 0" @click.away="searchQuery = ''" class="absolute top-10 right-0 w-80 bg-white text-gray-800 shadow-2xl rounded border border-gray-200 z-50 overflow-hidden" x-cloak>
                            <template x-for="result in searchResults" :key="result.id">
                                <div @click="openSubarea(result); searchQuery = ''" class="p-3 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-0">
                                    <p class="text-xs font-bold text-eb-green uppercase" x-text="'Subárea 0' + result.id"></p>
                                    <p class="text-sm font-semibold truncate" x-text="result.title[lang]"></p>
                                </div>
                            </template>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button @click="lang = 'pt'" class="opacity-70 hover:opacity-100 transition hover:scale-110"><img src="https://flagcdn.com/w40/br.png" class="h-4 w-6 rounded shadow-sm"></button>
                        <button @click="lang = 'en'" class="opacity-70 hover:opacity-100 transition hover:scale-110"><img src="https://flagcdn.com/w40/us.png" class="h-4 w-6 rounded shadow-sm"></button>
                        <button @click="lang = 'es'" class="opacity-70 hover:opacity-100 transition hover:scale-110"><img src="https://flagcdn.com/w40/es.png" class="h-4 w-6 rounded shadow-sm"></button>
                    </div>
                    <button class="md:hidden text-2xl" @click="mobileMenuOpen = !mobileMenuOpen"><i class="fa-solid fa-bars"></i></button>
                </div>
            </div>
            
            <div class="hidden md:flex justify-center mt-3 space-x-8 text-xs font-bold uppercase tracking-widest border-t border-green-800 pt-3">
                <button @click="view = 'home'" class="hover:text-eb-gold transition py-1 border-b-2 border-transparent" :class="{'text-eb-gold border-eb-gold': view === 'home'}" x-text="t[lang].nav_home"></button>
                <button @click="view = 'research'" class="hover:text-eb-gold transition py-1 border-b-2 border-transparent" :class="{'text-eb-gold border-eb-gold': view === 'research'}" x-text="t[lang].nav_research"></button>
                <button @click="view = 'events'" class="hover:text-eb-gold transition py-1 border-b-2 border-transparent" :class="{'text-eb-gold border-eb-gold': view === 'events'}" x-text="t[lang].nav_courses"></button>
                <button @click="view = 'all_researchers'" class="hover:text-eb-gold transition py-1 border-b-2 border-transparent" :class="{'text-eb-gold border-eb-gold': view === 'all_researchers'}" x-text="t[lang].nav_all_researchers"></button>
                <button @click="view = 'theses'" class="hover:text-eb-gold transition py-1 border-b-2 border-transparent" :class="{'text-eb-gold border-eb-gold': view === 'theses'}" x-text="t[lang].nav_theses"></button>
                <button @click="view = 'all_publications'" class="hover:text-eb-gold transition py-1 border-b-2 border-transparent" :class="{'text-eb-gold border-eb-gold': view === 'all_publications'}" x-text="t[lang].nav_all_publications"></button>
                <button @click="view = 'contact'" class="hover:text-eb-gold transition py-1 border-b-2 border-transparent" :class="{'text-eb-gold border-eb-gold': view === 'contact'}" x-text="t[lang].nav_contact"></button>
            </div>
            
            <div x-show="mobileMenuOpen" class="md:hidden mt-4 pb-4 border-t border-green-800" x-cloak>
                <button @click="view = 'home'; mobileMenuOpen = false" class="block py-2 w-full text-left" x-text="t[lang].nav_home"></button>
                <button @click="view = 'research'; mobileMenuOpen = false" class="block py-2 w-full text-left" x-text="t[lang].nav_research"></button>
                <button @click="view = 'events'; mobileMenuOpen = false" class="block py-2 w-full text-left" x-text="t[lang].nav_courses"></button>
                <button @click="view = 'all_researchers'; mobileMenuOpen = false" class="block py-2 w-full text-left" x-text="t[lang].nav_all_researchers"></button>
                <button @click="view = 'theses'; mobileMenuOpen = false" class="block py-2 w-full text-left" x-text="t[lang].nav_theses"></button>
                <button @click="view = 'all_publications'; mobileMenuOpen = false" class="block py-2 w-full text-left" x-text="t[lang].nav_all_publications"></button>
                <button @click="view = 'contact'; mobileMenuOpen = false" class="block py-2 w-full text-left" x-text="t[lang].nav_contact"></button>
            </div>
        </div>
    </nav>

    <main x-show="view === 'home'" x-transition.opacity.duration.300ms class="flex-grow">
        <section class="bg-gray-100">
            <div class="container mx-auto px-0 md:px-6 py-6">
                <div class="bg-white rounded shadow-lg overflow-hidden border border-gray-200" x-show="news.length > 0">
                    <div class="relative h-[300px] md:h-[400px] overflow-hidden bg-gray-300">
                        <template x-for="(item, index) in news" :key="index">
                            <div x-show="activeSlide === index" x-transition:enter="transition ease-in duration-500" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" class="absolute inset-0 bg-cover bg-center" :style="`background-image: url('${item.image}')`"></div>
                        </template>
                        <button @click="prevSlide()" class="absolute left-0 h-full px-4 text-white hover:bg-black/30 transition"><i class="fa-solid fa-chevron-left text-3xl shadow-black drop-shadow-md"></i></button>
                        <button @click="nextSlide()" class="absolute right-0 h-full px-4 text-white hover:bg-black/30 transition"><i class="fa-solid fa-chevron-right text-3xl shadow-black drop-shadow-md"></i></button>
                    </div>
                    <div class="bg-eb-green text-white p-8 md:p-10 text-center relative">
                        <div class="absolute -top-4 left-1/2 -translate-x-1/2 flex space-x-2">
                            <template x-for="(item, index) in news" :key="index">
                                <button @click="activeSlide = index" class="w-3 h-3 rounded-full border-2 border-eb-green transition-all" :class="activeSlide === index ? 'bg-eb-gold scale-125' : 'bg-white'"></button>
                            </template>
                        </div>
                        <template x-for="(item, index) in news" :key="index">
                            <div x-show="activeSlide === index">
                                <span class="text-eb-gold font-bold text-xs uppercase tracking-widest mb-2 block" x-text="t[lang].news_label"></span>
                                <h2 class="text-2xl md:text-4xl font-extrabold uppercase mb-4 leading-tight" x-text="item.title[lang]"></h2>
                                <p class="text-sm md:text-base text-gray-300 max-w-4xl mx-auto leading-relaxed line-clamp-4" x-text="item.desc[lang]"></p>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </section>

        <section class="py-16 bg-white border-b border-gray-200">
            <div class="container mx-auto px-6 max-w-6xl text-center">
                <h2 class="text-2xl font-bold text-eb-green uppercase mb-12 border-b-2 border-eb-gold inline-block pb-2" x-text="t[lang].leadership_title"></h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 items-start">
                    <div class="flex flex-col items-center p-6 bg-gray-50 rounded shadow-sm hover:shadow-md transition h-full border-t-4 border-eb-green">
                        <div class="w-28 h-28 bg-gray-200 rounded-full mb-4 border-4 border-eb-green overflow-hidden shadow-sm flex items-center justify-center relative bg-gray-100">
                            <template x-if="leadership.coord.photo"><img :src="leadership.coord.photo" class="w-full h-full object-cover object-top" alt="Foto"></template>
                            <template x-if="!leadership.coord.photo"><i class="fa-solid fa-user text-5xl text-gray-400"></i></template>
                        </div>
                        <h3 class="text-lg font-bold text-gray-900 leading-tight min-h-[3rem] flex items-center justify-center" x-text="leadership.coord.name"></h3>
                        <p class="text-eb-gold font-bold text-xs uppercase tracking-widest mb-3 mt-2" x-text="t[lang].coord_role"></p>
                        <a :href="leadership.coord.lattes" target="_blank" class="text-xs text-blue-700 hover:underline mt-auto border border-blue-200 px-3 py-1 rounded-full">Lattes CV <i class="fa-solid fa-external-link-alt ml-1"></i></a>
                    </div>
                    <div class="flex flex-col items-center p-6 bg-gray-50 rounded shadow-sm hover:shadow-md transition h-full border-t-4 border-eb-gold">
                        <div class="w-28 h-28 bg-gray-200 rounded-full mb-4 border-4 border-eb-gold overflow-hidden shadow-sm flex items-center justify-center relative bg-gray-100">
                            <template x-if="leadership.subA.photo"><img :src="leadership.subA.photo" class="w-full h-full object-cover object-top" alt="Foto Grigoli"></template>
                            <template x-if="!leadership.subA.photo"><i class="fa-solid fa-user text-5xl text-gray-400"></i></template>
                        </div>
                        <h3 class="text-lg font-bold text-gray-900 leading-tight min-h-[3rem] flex items-center justify-center" x-text="leadership.subA.name"></h3>
                        <p class="text-gray-500 text-xs uppercase font-bold tracking-widest mb-3 mt-2" x-text="t[lang].sub_a_role"></p>
                        <a :href="leadership.subA.lattes" target="_blank" class="text-xs text-blue-700 hover:underline mt-auto border border-blue-200 px-3 py-1 rounded-full">Lattes CV <i class="fa-solid fa-external-link-alt ml-1"></i></a>
                    </div>
                    <div class="flex flex-col items-center p-6 bg-gray-50 rounded shadow-sm hover:shadow-md transition h-full border-t-4 border-eb-gold">
                        <div class="w-28 h-28 bg-gray-200 rounded-full mb-4 border-4 border-eb-gold overflow-hidden shadow-sm flex items-center justify-center relative bg-gray-100">
                             <template x-if="leadership.subB.photo"><img :src="leadership.subB.photo" class="w-full h-full object-cover object-top" alt="Foto Josias"></template>
                            <template x-if="!leadership.subB.photo"><i class="fa-solid fa-user text-5xl text-gray-400"></i></template>
                        </div>
                        <h3 class="text-lg font-bold text-gray-900 leading-tight min-h-[3rem] flex items-center justify-center" x-text="leadership.subB.name"></h3>
                        <p class="text-gray-500 text-xs uppercase font-bold tracking-widest mb-3 mt-2" x-text="t[lang].sub_b_role"></p>
                        <a :href="leadership.subB.lattes" target="_blank" class="text-xs text-blue-700 hover:underline mt-auto border border-blue-200 px-3 py-1 rounded-full">Lattes CV <i class="fa-solid fa-external-link-alt ml-1"></i></a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div x-show="view === 'research'" x-cloak x-transition.opacity.duration.300ms class="flex-grow bg-gray-100">
        <section class="py-16">
            <div class="container mx-auto px-6 mb-12 text-center">
                <h2 class="text-3xl font-bold text-eb-green uppercase" x-text="t[lang].structure_title"></h2>
                <p class="text-gray-500 mt-2 italic" x-text="t[lang].structure_subtitle"></p>
            </div>
            <div class="container mx-auto px-6 max-w-6xl">
                <div class="mb-16">
                    <div class="flex items-center mb-6 border-b border-gray-300 pb-2">
                        <div class="h-8 w-1 bg-eb-gold mr-4"></div>
                        <h3 class="text-2xl font-bold text-eb-green uppercase" x-text="t[lang].line_a_label"></h3>
                    </div>
                    <div class="grid md:grid-cols-2 gap-8">
                        <template x-for="area in subareas.filter(a => a.line === 'A')" :key="area.id">
                            <button @click="openSubarea(area)" class="bg-white p-8 border-l-4 border-eb-green shadow hover:shadow-xl hover:-translate-y-1 transition-all duration-300 text-left flex flex-col group h-full relative overflow-hidden">
                                <div class="absolute top-0 right-0 p-4 opacity-5 group-hover:opacity-10 transition"><i :class="area.icon" class="text-9xl text-eb-green"></i></div>
                                <div class="flex justify-between mb-4 relative z-10">
                                    <i :class="area.icon" class="text-eb-gold text-4xl group-hover:scale-110 transition-transform"></i>
                                    <span class="text-gray-300 font-bold text-2xl" x-text="'0' + area.id"></span>
                                </div>
                                <h4 class="text-lg font-bold text-eb-green uppercase leading-tight mb-2 relative z-10" x-text="area.title[lang]"></h4>
                                <p class="text-sm text-gray-500 italic mb-6 relative z-10" x-text="area.subtitle[lang]"></p>
                                <div class="mt-auto text-xs font-bold text-eb-gold uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-opacity relative z-10 flex items-center">
                                    <span x-text="t[lang].access_area"></span> <i class="fa-solid fa-arrow-right ml-2"></i>
                                </div>
                            </button>
                        </template>
                    </div>
                </div>
                <div>
                    <div class="flex items-center mb-6 border-b border-gray-300 pb-2">
                        <div class="h-8 w-1 bg-eb-gold mr-4"></div>
                        <h3 class="text-2xl font-bold text-eb-green uppercase" x-text="t[lang].line_b_label"></h3>
                    </div>
                    <div class="grid md:grid-cols-2 gap-8">
                        <template x-for="area in subareas.filter(a => a.line === 'B')" :key="area.id">
                            <button @click="openSubarea(area)" class="bg-white p-8 border-l-4 border-eb-green shadow hover:shadow-xl hover:-translate-y-1 transition-all duration-300 text-left flex flex-col group h-full relative overflow-hidden">
                                <div class="absolute top-0 right-0 p-4 opacity-5 group-hover:opacity-10 transition"><i :class="area.icon" class="text-9xl text-eb-green"></i></div>
                                <div class="flex justify-between mb-4 relative z-10">
                                    <i :class="area.icon" class="text-eb-gold text-4xl group-hover:scale-110 transition-transform"></i>
                                    <span class="text-gray-300 font-bold text-2xl" x-text="'0' + area.id"></span>
                                </div>
                                <h4 class="text-lg font-bold text-eb-green uppercase leading-tight mb-2 relative z-10" x-text="area.title[lang]"></h4>
                                <p class="text-sm text-gray-500 italic mb-6 relative z-10" x-text="area.subtitle[lang]"></p>
                                <div class="mt-auto text-xs font-bold text-eb-gold uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-opacity relative z-10 flex items-center">
                                    <span x-text="t[lang].access_area"></span> <i class="fa-solid fa-arrow-right ml-2"></i>
                                </div>
                            </button>
                        </template>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <div x-show="view === 'events'" x-cloak x-transition.opacity.duration.300ms class="flex-grow bg-gray-50">
        <header class="bg-eb-green py-12 text-white text-center border-b-4 border-eb-gold">
            <h2 class="text-3xl font-bold uppercase" x-text="t[lang].courses_title"></h2>
            <p class="text-gray-300 mt-2 italic" x-text="t[lang].courses_subtitle"></p>
        </header>
        <div class="container mx-auto px-6 py-12 max-w-5xl">
            <div class="grid gap-8">
                <template x-for="event in courses" :key="event.id">
                    <div class="bg-white rounded-lg shadow-md overflow-hidden border border-gray-200 flex flex-col md:flex-row hover:shadow-lg transition">
                        <div class="bg-gray-200 md:w-64 h-48 md:h-auto flex-shrink-0 flex items-center justify-center flex-col text-gray-500">
                            <span class="text-4xl font-bold text-eb-green" x-text="event.day"></span>
                            <span class="text-sm font-bold uppercase tracking-widest" x-text="event.month[lang]"></span>
                        </div>
                        <div class="p-6 flex flex-col justify-between flex-grow">
                            <div>
                                <div class="flex justify-between items-start">
                                    <span class="bg-eb-gold text-gray-900 text-[10px] font-bold px-2 py-1 uppercase rounded mb-2 inline-block" x-text="event.type[lang]"></span>
                                    <span :class="event.active ? 'text-green-600' : 'text-red-500'" class="text-xs font-bold uppercase border px-2 py-1 rounded" x-text="event.active ? t[lang].status_open : t[lang].status_closed"></span>
                                </div>
                                <h3 class="text-xl font-bold text-eb-green mb-2" x-text="event.title[lang]"></h3>
                                <p class="text-gray-600 text-sm mb-4 leading-relaxed" x-text="event.desc[lang]"></p>
                            </div>
                            <div class="flex items-center justify-between border-t border-gray-100 pt-4 mt-2">
                                <span class="text-xs text-gray-500"><i class="fa-solid fa-clock mr-1"></i> <span x-text="event.time"></span></span>
                                <button x-show="event.material_link" class="text-xs bg-eb-green text-white px-4 py-2 rounded hover:bg-green-800 transition font-bold uppercase"><i class="fa-solid fa-download mr-2"></i> <span x-text="t[lang].download_material"></span></button>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </div>

    <div x-show="view === 'all_researchers'" x-cloak x-transition.opacity.duration.300ms class="flex-grow bg-gray-50">
        <header class="bg-eb-green py-12 text-white text-center border-b-4 border-eb-gold">
            <h2 class="text-3xl font-bold uppercase" x-text="t[lang].nav_all_researchers"></h2>
            <p class="text-gray-300 mt-2 italic" x-text="t[lang].all_researchers_subtitle"></p>
        </header>
        <div class="container mx-auto px-6 py-12 max-w-6xl">
            <template x-for="area in subareas" :key="area.id">
                <div x-show="area.researchers.length > 0" class="mb-16">
                    <div class="flex items-center mb-6 border-b border-gray-300 pb-2">
                        <div class="h-8 w-1 bg-eb-gold mr-4"></div>
                        <div>
                             <span class="text-xs font-bold text-eb-gold uppercase tracking-widest block" x-text="area.line === 'A' ? t[lang].line_a_label : t[lang].line_b_label"></span>
                             <h3 class="text-2xl font-bold text-eb-green uppercase" x-text="area.title[lang]"></h3>
                        </div>
                    </div>
                    <div class="grid md:grid-cols-2 gap-6">
                        <template x-for="researcher in area.researchers">
                            <div class="bg-white p-6 rounded shadow-sm border border-gray-200 hover:shadow-md transition flex items-start">
                                <div class="w-16 h-16 bg-gray-200 rounded-full flex-shrink-0 overflow-hidden mr-4 relative border-2 border-eb-green">
                                    <template x-if="researcher.photo"><img :src="researcher.photo" class="w-full h-full object-cover object-top" alt="Foto"></template>
                                    <template x-if="!researcher.photo"><div class="w-full h-full bg-eb-green flex items-center justify-center text-white font-bold text-lg"><span x-text="getInitials(researcher.name)"></span></div></template>
                                </div>
                                <div>
                                    <h4 class="font-bold text-eb-green" x-text="researcher.name"></h4>
                                    <p class="text-xs text-eb-gold uppercase font-bold tracking-widest mb-2" x-text="researcher.role[lang]"></p>
                                    <p class="text-sm text-gray-600 mb-3" x-text="researcher.bio[lang]"></p>
                                    <a :href="researcher.lattes" target="_blank" class="text-xs text-blue-800 hover:underline font-bold">Lattes CV <i class="fa-solid fa-external-link-alt ml-1"></i></a>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <div x-show="view === 'theses'" x-cloak x-transition.opacity.duration.300ms class="flex-grow bg-gray-50">
        <header class="bg-eb-green py-12 text-white text-center border-b-4 border-eb-gold">
            <h2 class="text-3xl font-bold uppercase" x-text="t[lang].nav_theses"></h2>
            <p class="text-gray-300 mt-2 italic" x-text="t[lang].theses_subtitle"></p>
        </header>
        <div class="bg-white shadow sticky top-[62px] md:top-[66px] z-30">
            <div class="container mx-auto px-6 flex justify-center space-x-8 overflow-x-auto no-scrollbar">
                <button @click="activeThesisTab = 'Tese'" :class="{ 'tab-active': activeThesisTab === 'Tese' }" class="py-4 text-xs md:text-sm font-bold uppercase tracking-wide text-gray-500 hover:text-eb-green transition whitespace-nowrap">Teses</button>
                <button @click="activeThesisTab = 'Dissertação'" :class="{ 'tab-active': activeThesisTab === 'Dissertação' }" class="py-4 text-xs md:text-sm font-bold uppercase tracking-wide text-gray-500 hover:text-eb-green transition whitespace-nowrap">Dissertações</button>
                <button @click="activeThesisTab = 'TCC'" :class="{ 'tab-active': activeThesisTab === 'TCC' }" class="py-4 text-xs md:text-sm font-bold uppercase tracking-wide text-gray-500 hover:text-eb-green transition whitespace-nowrap">TCC</button>
            </div>
        </div>
        <div class="container mx-auto px-6 py-12 max-w-5xl">
            <template x-for="group in getStructuredTheses(activeThesisTab)" :key="group.year">
                <div class="mb-10">
                    <div class="flex items-center mb-6">
                        <span class="bg-eb-gold text-gray-900 font-bold text-sm px-3 py-1 rounded-sm shadow-sm" x-text="group.year"></span>
                        <div class="h-px bg-gray-200 flex-grow ml-4"></div>
                    </div>
                    <div class="grid gap-4">
                        <template x-for="doc in group.docs">
                            <div class="bg-white p-6 rounded shadow-sm border border-gray-200 hover:border-eb-green hover:shadow-md transition flex items-center justify-between">
                                <div>
                                    <h4 class="text-lg font-bold text-eb-green mb-1" x-text="doc.title"></h4>
                                    <p class="text-sm text-gray-600"><i class="fa-solid fa-user-graduate mr-2 text-eb-gold"></i> <span x-text="doc.researcher"></span></p>
                                </div>
                                <div class="text-center ml-4 flex-shrink-0">
                                    <a :href="doc.file_link" target="_blank" @click="doc.downloads++" class="block bg-eb-green text-white text-xs font-bold uppercase px-4 py-2 rounded hover:bg-green-800 transition">
                                        <i class="fa-solid fa-download mr-1"></i> PDF
                                    </a>
                                    <p class="text-[10px] text-gray-400 mt-1"><span x-text="doc.downloads"></span> downloads</p>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </template>
            <div x-show="getStructuredTheses(activeThesisTab).length === 0" class="text-center py-12 text-gray-500 italic">
                Nenhum documento encontrado nesta categoria.
            </div>
        </div>
    </div>

    <div x-show="view === 'all_publications'" x-cloak x-transition.opacity.duration.300ms class="flex-grow bg-gray-50">
        <header class="bg-eb-green py-12 text-white text-center border-b-4 border-eb-gold">
            <h2 class="text-3xl font-bold uppercase" x-text="t[lang].nav_all_publications"></h2>
            <p class="text-gray-300 mt-2 italic" x-text="t[lang].all_pubs_subtitle"></p>
        </header>

        <div class="bg-white shadow sticky top-[62px] md:top-[66px] z-30">
            <div class="container mx-auto px-6 flex justify-center space-x-8 overflow-x-auto no-scrollbar">
                <button @click="activePubSubarea = 1" :class="{ 'tab-active': activePubSubarea === 1 }" class="py-4 text-xs md:text-sm font-bold uppercase tracking-wide text-gray-500 hover:text-eb-green transition whitespace-nowrap">Subárea 01</button>
                <button @click="activePubSubarea = 2" :class="{ 'tab-active': activePubSubarea === 2 }" class="py-4 text-xs md:text-sm font-bold uppercase tracking-wide text-gray-500 hover:text-eb-green transition whitespace-nowrap">Subárea 02</button>
                <button @click="activePubSubarea = 3" :class="{ 'tab-active': activePubSubarea === 3 }" class="py-4 text-xs md:text-sm font-bold uppercase tracking-wide text-gray-500 hover:text-eb-green transition whitespace-nowrap">Subárea 03</button>
                <button @click="activePubSubarea = 4" :class="{ 'tab-active': activePubSubarea === 4 }" class="py-4 text-xs md:text-sm font-bold uppercase tracking-wide text-gray-500 hover:text-eb-green transition whitespace-nowrap">Subárea 04</button>
            </div>
        </div>

        <div class="container mx-auto px-6 py-12 max-w-5xl">
            <template x-for="group in getStructuredPublications(activePubSubarea)" :key="group.year">
                <div class="mb-10">
                    <div class="flex items-center mb-6">
                        <span class="bg-eb-gold text-gray-900 font-bold text-sm px-3 py-1 rounded-sm shadow-sm" x-text="group.year"></span>
                        <div class="h-px bg-gray-200 flex-grow ml-4"></div>
                    </div>
                    <div class="bg-white p-8 rounded shadow-sm border border-gray-200">
                        <ul class="space-y-6">
                            <template x-for="pub in group.docs">
                                <li class="border-b border-gray-100 pb-4 last:border-0">
                                    <div class="flex items-start">
                                        <template x-if="pub.link">
                                            <a :href="pub.link" target="_blank" @click="pub.downloads = (pub.downloads || 0) + 1" class="flex-shrink-0 cursor-pointer hover:scale-110 transition group" title="Acessar Publicação">
                                                <i class="fa-solid fa-file-pdf text-red-600 text-xl mt-1 mr-4"></i>
                                            </a>
                                        </template>
                                        <template x-if="!pub.link">
                                            <div class="flex-shrink-0"><i class="fa-solid fa-file-pdf text-gray-400 text-xl mt-1 mr-4"></i></div>
                                        </template>
                                        <div class="flex-grow">
                                            <template x-if="pub.link">
                                                <a :href="pub.link" target="_blank" @click="pub.downloads = (pub.downloads || 0) + 1" class="font-bold text-blue-800 hover:text-blue-600 hover:underline cursor-pointer block leading-tight">
                                                    <span x-text="pub.title"></span> <i class="fa-solid fa-arrow-up-right-from-square text-[10px] ml-1 opacity-70"></i>
                                                </a>
                                            </template>
                                            <template x-if="!pub.link">
                                                <h4 class="font-bold text-gray-900 leading-tight cursor-default" x-text="pub.title"></h4>
                                            </template>
                                            <p class="text-sm text-gray-600 mt-1"><span x-text="pub.authors"></span> • <span class="italic" x-text="pub.journal"></span>, <span x-text="pub.year"></span>.</p>
                                        </div>
                                        <div class="ml-4 flex-shrink-0 text-center min-w-[60px]" x-show="pub.link">
                                            <span class="text-xs font-bold text-gray-400 block"><i class="fa-solid fa-eye mr-1"></i><span x-text="pub.downloads || 0"></span></span>
                                        </div>
                                    </div>
                                </li>
                            </template>
                        </ul>
                    </div>
                </div>
            </template>
            <div x-show="getStructuredPublications(activePubSubarea).length === 0" class="text-center py-12 text-gray-500 italic">
                Nenhuma publicação encontrada nesta subárea.
            </div>
        </div>
    </div>

    <div x-show="view === 'contact'" x-cloak x-transition.opacity.duration.300ms class="flex-grow bg-gray-50">
        <header class="bg-eb-green py-12 text-white text-center border-b-4 border-eb-gold">
            <h2 class="text-3xl font-bold uppercase" x-text="t[lang].contact_title"></h2>
        </header>
        <div class="container mx-auto px-6 py-12 max-w-6xl">
            <div class="bg-white shadow rounded p-8 border-t-4 border-eb-green grid md:grid-cols-2 gap-12">
                <div>
                    <h3 class="text-xl font-bold text-eb-green mb-6 uppercase" x-text="t[lang].contact_info"></h3>
                    <div class="space-y-6 text-gray-700">
                        <div class="flex items-start">
                            <i class="fa-solid fa-location-dot mt-1 mr-4 text-eb-gold text-xl"></i>
                            <span><strong>Escola de Comando e Estado-Maior do Exército</strong><br>Praça Gen. Tibúrcio, 125<br>Praia Vermelha - Urca<br>Rio de Janeiro - RJ, 22290-270</span>
                        </div>
                        <p class="flex items-center"><i class="fa-solid fa-envelope mr-4 text-eb-gold text-xl"></i> lcm.dppg@eceme.eb.mil.br</p>
                        <p class="flex items-center"><i class="fa-solid fa-phone mr-4 text-eb-gold text-xl"></i> (21) 3543-3456</p>
                    </div>
                </div>
                <div class="map-container rounded overflow-hidden shadow-lg border border-gray-300 bg-gray-100 h-96">
                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3674.5661601614725!2d-43.16489368441829!3d-22.95415794443916!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x99801ca4795e1d%3A0x6331893952541a8!2sEscola%20de%20Comando%20e%20Estado-Maior%20do%20Ex%C3%A9rcito!5e0!3m2!1spt-BR!2sbr!4v1705680000000!5m2!1spt-BR!2sbr" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                </div>
            </div>
        </div>
    </div>

    <div x-show="view === 'subarea'" x-cloak x-transition.opacity.duration.300ms class="flex-grow bg-gray-50">
        <div class="bg-eb-green text-white py-12 border-b-4 border-eb-gold">
            <div class="container mx-auto px-6">
                <button @click="view = 'research'" class="text-xs font-bold uppercase tracking-widest text-eb-gold hover:text-white mb-6 flex items-center transition-colors"><i class="fa-solid fa-arrow-left mr-2"></i> <span x-text="t[lang].back_research"></span></button>
                <div class="flex flex-col md:flex-row items-start justify-between">
                    <div class="max-w-3xl">
                        <span class="bg-eb-gold text-eb-green text-xs font-bold px-2 py-1 uppercase rounded-sm mb-3 inline-block" x-text="activeArea.line === 'A' ? t[lang].line_a_label : t[lang].line_b_label"></span>
                        <h2 class="text-3xl md:text-4xl font-extrabold uppercase leading-tight mb-2" x-text="activeArea.title[lang]"></h2>
                        <p class="text-lg text-gray-300 italic" x-text="activeArea.subtitle[lang]"></p>
                    </div>
                    <i :class="activeArea.icon" class="text-eb-gold text-6xl opacity-20 mt-6 md:mt-0"></i>
                </div>
            </div>
        </div>
        <div class="bg-white shadow sticky top-[62px] md:top-[66px] z-30">
            <div class="container mx-auto px-6">
                <div class="flex space-x-8 overflow-x-auto no-scrollbar">
                    <button @click="tab = 'sobre'" :class="{ 'tab-active': tab === 'sobre' }" class="py-4 text-xs md:text-sm font-bold uppercase tracking-wide text-gray-500 hover:text-eb-green transition whitespace-nowrap" x-text="t[lang].tab_about"></button>
                    <button @click="tab = 'pesquisadores'" :class="{ 'tab-active': tab === 'pesquisadores' }" class="py-4 text-xs md:text-sm font-bold uppercase tracking-wide text-gray-500 hover:text-eb-green transition whitespace-nowrap" x-text="t[lang].tab_researchers"></button>
                    <button @click="tab = 'andamento'" :class="{ 'tab-active': tab === 'andamento' }" class="py-4 text-xs md:text-sm font-bold uppercase tracking-wide text-gray-500 hover:text-eb-green transition whitespace-nowrap" x-text="t[lang].tab_projects"></button>
                    <button @click="tab = 'publicacoes'" :class="{ 'tab-active': tab === 'publicacoes' }" class="py-4 text-xs md:text-sm font-bold uppercase tracking-wide text-gray-500 hover:text-eb-green transition whitespace-nowrap" x-text="t[lang].tab_publications"></button>
                </div>
            </div>
        </div>
        <div class="container mx-auto px-6 py-10 max-w-6xl">
            <div x-show="tab === 'sobre'" x-transition.opacity>
                <div class="bg-white p-8 rounded shadow-sm border-t-4 border-eb-green mb-8">
                    <div class="mb-10">
                        <h3 class="text-lg font-bold text-eb-green mb-4 uppercase flex items-center"><i class="fa-solid fa-crosshairs text-eb-gold mr-3"></i> <span x-text="t[lang].label_focus"></span></h3>
                        <p class="text-gray-700 italic border-l-4 border-eb-gold pl-4 leading-relaxed text-lg" x-text="activeArea.focus[lang]"></p>
                    </div>
                    <div class="mb-10">
                        <h3 class="text-lg font-bold text-eb-green mb-4 uppercase flex items-center"><i class="fa-solid fa-list-check text-eb-gold mr-3"></i> <span x-text="t[lang].label_topics"></span></h3>
                        <div class="grid md:grid-cols-2 gap-x-12 gap-y-3">
                            <template x-for="topic in activeArea.topics[lang]">
                                <li class="flex items-start p-2 border-b border-gray-100 last:border-0"><i class="fa-solid fa-check text-eb-green mt-1 mr-3 flex-shrink-0 text-xs"></i><span class="text-gray-800 text-sm leading-snug" x-text="topic"></span></li>
                            </template>
                        </div>
                    </div>
                    <div class="bg-gray-50 p-6 rounded border border-gray-200">
                        <h3 class="text-lg font-bold text-eb-green mb-3 uppercase flex items-center"><i class="fa-solid fa-microchip text-eb-gold mr-3"></i> <span x-text="t[lang].label_tech"></span></h3>
                        <p class="text-sm text-gray-700 leading-relaxed" x-text="activeArea.tech[lang]"></p>
                    </div>
                </div>
            </div>
            
            <div x-show="tab === 'pesquisadores'" x-transition.opacity>
                <div class="grid md:grid-cols-2 gap-6">
                    <template x-for="researcher in activeArea.researchers">
                        <div class="bg-white p-6 rounded shadow-sm border border-gray-200 hover:shadow-md transition flex items-start">
                            <div class="w-16 h-16 bg-gray-200 rounded-full flex-shrink-0 overflow-hidden mr-4 relative border-2 border-eb-green">
                                <template x-if="researcher.photo"><img :src="researcher.photo" class="w-full h-full object-cover object-top" alt="Foto"></template>
                                <template x-if="!researcher.photo"><div class="w-full h-full bg-eb-green flex items-center justify-center text-white font-bold text-lg"><span x-text="getInitials(researcher.name)"></span></div></template>
                            </div>
                            <div>
                                <h4 class="font-bold text-eb-green" x-text="researcher.name"></h4>
                                <p class="text-xs text-eb-gold uppercase font-bold tracking-widest mb-2" x-text="researcher.role[lang]"></p>
                                <p class="text-sm text-gray-600 mb-3" x-text="researcher.bio[lang]"></p>
                                <a :href="researcher.lattes" target="_blank" class="text-xs text-blue-800 hover:underline font-bold">Lattes CV <i class="fa-solid fa-external-link-alt ml-1"></i></a>
                            </div>
                        </div>
                    </template>
                    <div x-show="activeArea.researchers.length === 0" class="col-span-2 text-center text-gray-500 italic p-8"><span x-text="t[lang].no_data"></span></div>
                </div>
            </div>

            <div x-show="tab === 'andamento'" x-transition.opacity>
                 <div class="bg-white rounded shadow-sm border border-gray-200 overflow-hidden">
                    <table class="w-full text-left">
                        <thead class="bg-eb-green text-white text-xs uppercase">
                            <tr><th class="p-4" x-text="t[lang].col_project"></th><th class="p-4 hidden md:table-cell" x-text="t[lang].col_responsible"></th><th class="p-4" x-text="t[lang].col_status"></th></tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            <template x-for="project in activeArea.ongoing">
                                <tr class="hover:bg-gray-50">
                                    <td class="p-4 font-bold text-gray-800 text-sm" x-text="project.title[lang]"></td>
                                    <td class="p-4 text-sm text-gray-600 hidden md:table-cell" x-text="project.responsible"></td>
                                    <td class="p-4"><span class="bg-yellow-100 text-yellow-800 text-[10px] font-bold px-2 py-1 rounded-full uppercase" x-text="t[lang].status_ongoing"></span></td>
                                </tr>
                            </template>
                            <tr x-show="activeArea.ongoing.length === 0"><td colspan="3" class="p-8 text-center text-gray-500 italic" x-text="t[lang].no_data"></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div x-show="tab === 'publicacoes'" x-transition.opacity>
                <div class="bg-white p-8 rounded shadow-sm border border-gray-200">
                    <ul class="space-y-6">
                        <template x-for="pub in activeArea.publications">
                            <li class="border-b border-gray-100 pb-4 last:border-0">
                                <div class="flex items-start">
                                    <template x-if="pub.link">
                                        <a :href="pub.link" target="_blank" class="flex-shrink-0 cursor-pointer hover:scale-110 transition" title="Acessar Publicação">
                                            <i class="fa-solid fa-file-pdf text-red-600 text-xl mt-1 mr-4"></i>
                                        </a>
                                    </template>
                                    <template x-if="!pub.link">
                                        <div class="flex-shrink-0"><i class="fa-solid fa-file-pdf text-gray-400 text-xl mt-1 mr-4"></i></div>
                                    </template>
                                    <div>
                                        <template x-if="pub.link">
                                            <a :href="pub.link" target="_blank" class="font-bold text-blue-800 hover:text-blue-600 hover:underline cursor-pointer block leading-tight">
                                                <span x-text="pub.title"></span> <i class="fa-solid fa-arrow-up-right-from-square text-[10px] ml-1 opacity-70"></i>
                                            </a>
                                        </template>
                                        <template x-if="!pub.link">
                                            <h4 class="font-bold text-gray-900 leading-tight cursor-default" x-text="pub.title"></h4>
                                        </template>
                                        <p class="text-sm text-gray-600 mt-1"><span x-text="pub.authors"></span> • <span class="italic" x-text="pub.journal"></span>, <span x-text="pub.year"></span>.</p>
                                    </div>
                                </div>
                            </li>
                        </template>
                        <li x-show="activeArea.publications.length === 0" class="text-center text-gray-500 italic" x-text="t[lang].no_data"></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-eb-green text-white py-12 border-t-8 border-eb-gold mt-auto">
        <div class="container mx-auto px-6 flex flex-col md:flex-row justify-between items-center">
            <div class="text-center md:text-left mb-6 md:mb-0">
                <h5 class="text-eb-gold font-bold uppercase mb-1">LCM - Laboratório de Ciências Militares</h5>
                <p class="text-xs text-gray-400">Escola de Comando e Estado-Maior do Exército</p>
            </div>
            <div class="flex space-x-6 text-2xl">
                <a href="https://linkedin.com/company/lcm-eceme-placeholder" target="_blank" class="hover:text-eb-gold transition transform hover:scale-110"><i class="fa-brands fa-linkedin"></i></a>
                <a href="https://instagram.com/lcm.eceme-placeholder" target="_blank" class="hover:text-eb-gold transition transform hover:scale-110"><i class="fa-brands fa-instagram"></i></a>
                <a href="https://youtube.com/channel/lcm-eceme-placeholder" target="_blank" class="hover:text-eb-gold transition transform hover:scale-110"><i class="fa-brands fa-youtube"></i></a>
            </div>
            <div class="text-center md:text-right mt-6 md:mt-0">
                <p class="text-xs text-gray-400">© 2026 PPGCM / ECEME</p>
            </div>
        </div>
    </footer>

    <script>
        function appData() {
            return {
                lang: 'pt',
                view: 'home',
                tab: 'sobre',
                activeArea: {},
                searchQuery: '',
                mobileMenuOpen: false,
                activeSlide: 0,
                
                // Variáveis das novas vistas
                activeThesisTab: 'Tese', 
                activePubSubarea: 1, 
                
                // Dados Globais
                theses: [], 
                all_raw_publications: [], // Corrigido: Inicializa vazio para evitar erro de undefined
                
                // Dados Vazios (Serão preenchidos via JSON)
                news: [],
                courses: [],
                subareas: [
                    {
                        id: 1, line: "A", icon: "fa-solid fa-diagram-project",
                        title: { pt: "Governança, Planejamento e Gestão de Capacidades", en: "Governance, Planning and Capability Management", es: "Gobernanza, Planificación y Gestión de Capacidades" },
                        subtitle: { pt: "PBC, Portfólio e Riscos", en: "CBP, Portfolio and Risks", es: "PBC, Cartera y Riesgos" },
                        focus: { pt: "PBC, portfólio, aquisições, ciclo de vida sob governança, riscos e simulação para decisão.", en: "CBP, portfolio, acquisitions, life cycle under governance, risks and simulation.", es: "PBC, cartera, adquisiciones, ciclo de vida bajo gobernanza, riesgos y simulación." },
                        tech: { pt: "Governança de IA, engenharia de decisões assistidas por software, gestão de maturidade tecnológica (TRL).", en: "AI Governance, software-assisted decision engineering, TRL management.", es: "Gobernanza de IA, ingeniería de decisiones asistida por software, TRL." },
                        topics: { pt: ["Planejamento Baseado em Capacidades (PBC)", "Priorização Multicritério", "Aquisições de Defesa", "Gestão do Ciclo de Vida (PLM)", "Gestão de Portfólio Estratégico", "Value for Money e Eficiência", "Gestão de Riscos Tecnológicos", "Compliance e Integridade", "Wargaming Analítico", "Simulação Construtiva para Decisão", "Modelagem de Força", "Racionalização Administrativa"], en: ["CBP", "Acquisitions"], es: ["PBC", "Adquisiciones"] },
                        researchers: [], ongoing: [], publications: []
                    },
                    {
                        id: 2, line: "A", icon: "fa-solid fa-industry",
                        title: { pt: "Capacidades, Logística, Mobilização e BID", en: "Capabilities, Logistics, Mobilization and DIB", es: "Capacidades, Logística, Movilización y BID" },
                        subtitle: { pt: "Economia de Defesa e Prontidão", en: "Defense Economics and Readiness", es: "Economía de Defensa y Preparación" },
                        focus: { pt: "Prontidão e sustentação; mobilização e resiliência nacional; economia de defesa e BID como base de autonomia.", en: "Readiness and sustainment; national mobilization and resilience; defense economics and DIB.", es: "Preparación y sostenimiento; movilización y resiliencia nacional; economía de defensa y BID." },
                        tech: { pt: "IA para manutenção preditiva, IoT/rastreabilidade, automação logística, manufatura aditiva.", en: "Predictive maintenance AI, IoT, logistics automation, additive manufacturing.", es: "IA para mantenimiento predictivo, IoT, automatización logística." },
                        topics: { pt: ["Logística Operacional e Sustentação", "Prontidão Logística (Readiness)", "Manutenção e Confiabilidade (RAM)", "Gestão de Estoques Estratégicos", "Mobilização Nacional e Industrial", "Resiliência de Cadeias Críticas", "Economia de Defesa e Orçamento", "Base Industrial de Defesa (BID)", "Política Industrial e Inovação", "Tecnologia Dual (Dual-Use)", "Dependências Externas", "Sistemas Autônomos na Logística"], en: ["Logistics"], es: ["Logística"] },
                        researchers: [], ongoing: [], publications: []
                    },
                    {
                        id: 3, line: "B", icon: "fa-solid fa-person-military-pointing",
                        title: { pt: "Operações, Doutrina e Superioridade Operacional", en: "Operations, Doctrine and Operational Superiority", es: "Operaciones, Doctrina y Superioridad Operacional" },
                        subtitle: { pt: "Multidomínio e Informacional", en: "Multi-domain and Informational", es: "Multidominio e Informacional" },
                        focus: { pt: "Emprego da força, arte operacional, doutrina, C2 e superioridade operacional (ISR/GE/ciber) no nível operacional.", en: "Use of force, operational art, doctrine, C2, ISR/EW/cyber at operational level.", es: "Empleo de la fuerza, arte operacional, doctrina, C2, ISR/GE/ciber a nivel operacional." },
                        tech: { pt: "Sistemas autônomos e robótica, IA no planejamento, sensores avançados, edge computing.", en: "Autonomous systems, AI planning, advanced sensors, edge computing.", es: "Sistemas autónomos, IA en planificación, sensores avanzados." },
                        topics: { pt: ["Arte Operacional e Desenho de Campanha", "Doutrina Militar Terrestre", "Operações Conjuntas e Interagências", "Operações Multidomínio (MDO)", "Comando e Controle (C2)", "Ciclo Decisório (OODA)", "Inteligência, Vigilância e Reconhecimento (ISR)", "Guerra Eletrônica Tática/Operacional", "Ciberespaço no Nível Tático", "Combate em Ambiente Urbano", "Guerra de Selva e Ambientes Complexos", "Simulação Viva, Virtual e Construtiva"], en: ["Operational Art"], es: ["Arte Operacional"] },
                        researchers: [], ongoing: [], publications: []
                    },
                    {
                        id: 4, line: "B", icon: "fa-solid fa-earth-americas",
                        title: { pt: "Estratégia, Geopolítica, Paz e Guerra", en: "Strategy, Geopolitics, Peace and War", es: "Estrategia, Geopolítica, Paz y Guerra" },
                        subtitle: { pt: "Dimensão Humana e Direito", en: "Human Dimension and Law", es: "Dimensión Humana y Derecho" },
                        focus: { pt: "Estratégia, poder nacional, cenários, paz e conflito, legitimidade e dimensão humana.", en: "Strategy, national power, scenarios, peace/conflict, legitimacy, human dimension.", es: "Estrategia, poder nacional, escenarios, paz/conflicto, legitimidad, dimensión humana." },
                        tech: { pt: "Impactos estratégicos de tecnologias críticas (IA/ciber), governança ética, operações de informação.", en: "Strategic impacts of tech, ethical governance, info ops.", es: "Impactos estratégicos de tec, gobernanza ética, ops de información." },
                        topics: { pt: ["Pensamento Estratégico Militar", "Geopolítica e Estudos Regionais", "Poder Nacional e Dissuasão", "Cenários Prospectivos e Early Warning", "Estudos de Paz e Estabilização", "Guerra Híbrida e Zona Cinza", "Dimensão Humana e Liderança", "Tomada de Decisão sob Estresse", "Ética Militar e Profissionalismo", "Direito Internacional dos Conflitos Armados", "Operações de Informação Estratégica", "Comunicação Estratégica"], en: ["Strategy"], es: ["Estrategia"] },
                        researchers: [], ongoing: [], publications: []
                    }
                ],

                leadership: {
                    coord: { name: "Eduardo Xavier Ferreira Glaser Migon", lattes: "http://lattes.cnpq.br/0133876688289429", photo: "./migon.png?v=1" },
                    subA: { name: "Guilherme de Araujo Grigoli", lattes: "http://lattes.cnpq.br/4082666910942025", photo: "./grigoli.png?v=1" },
                    subB: { name: "Josias Marcos de Resende Silva", lattes: "http://lattes.cnpq.br/9949858368400382", photo: "./josias.png?v=1" }
                },

                t: {
                    pt: { header_lcm_full: "Laboratório de Ciências Militares", header_eceme_full: "Escola de Comando e Estado-Maior do Exército", nav_home: "Início", nav_research: "Linhas de Pesquisa", nav_all_researchers: "Pesquisadores", nav_theses: "Teses e Dissertações", nav_all_publications: "Publicações", nav_contact: "Contato", nav_courses: "Cursos e Eventos", all_researchers_subtitle: "Corpo de pesquisadores do LCM dividido por subárea", theses_subtitle: "Repositório acadêmico do LCM", all_pubs_subtitle: "Acervo completo de publicações do LCM", news_label: "Destaque", leadership_title: "Coordenação LCM", coord_role: "Coordenador Geral", sub_a_role: "Coordenador da Linha de Pesquisa GD", sub_b_role: "Coordenador da Linha de Pesquisa EPG", line_a_label: "Linha A — Gestão de Defesa", line_b_label: "Linha B — Estudo da Paz e Guerra", structure_title: "Estrutura de Pesquisa", structure_subtitle: "Selecione uma subárea para detalhes", access_area: "ACESSAR ÁREA", back_research: "Voltar para Linhas de Pesquisa", tab_about: "Sobre a Área", tab_researchers: "Pesquisadores", tab_projects: "Projetos", tab_publications: "Publicações", label_focus: "Foco Estratégico", label_topics: "Temas Abrangentes", label_tech: "Tecnologias Transversais", contact_title: "Fale Conosco", contact_info: "Informações de Contato", contact_map: "Localização", contact_button: "Traçar Rota", courses_title: "Cursos e Eventos", courses_subtitle: "Acompanhe nossa agenda acadêmica", search_placeholder: "Buscar no site...", no_results: "Nenhum resultado encontrado.", col_project: "Projeto", col_responsible: "Responsável", col_status: "Status", status_ongoing: "Em Andamento", no_data: "Dados não disponíveis no momento.", download_material: "Baixar Material", status_open: "Inscrições Abertas", status_closed: "Encerrado" },
                    en: { header_lcm_full: "Military Sciences Laboratory", header_eceme_full: "Army Command and General Staff School", nav_home: "Home", nav_research: "Research Lines", nav_all_researchers: "Researchers", nav_theses: "Theses & Dissertations", nav_all_publications: "Publications", nav_contact: "Contact", nav_courses: "Courses & Events", all_researchers_subtitle: "LCM researchers organized by subarea", theses_subtitle: "LCM Academic Repository", all_pubs_subtitle: "Complete LCM publications archive", news_label: "Featured", leadership_title: "LCM Coordination", coord_role: "General Coordinator", sub_a_role: "GD Research Line Coordinator", sub_b_role: "EPG Research Line Coordinator", line_a_label: "Line A — Defense Management", line_b_label: "Line B — Peace and War Studies", structure_title: "Research Structure", structure_subtitle: "Select a subarea for details", access_area: "ACCESS AREA", back_research: "Back to Research Lines", tab_about: "About Area", tab_researchers: "Researchers", tab_projects: "Projects", tab_publications: "Publications", label_focus: "Strategic Focus", label_topics: "Comprehensive Themes", label_tech: "Transversal Technologies", contact_title: "Contact Us", contact_info: "Contact Information", contact_map: "Location", contact_button: "Get Directions", courses_title: "Courses & Events", courses_subtitle: "Follow our academic schedule", search_placeholder: "Search...", no_results: "No results found.", col_project: "Project", col_responsible: "Lead", col_status: "Status", status_ongoing: "Ongoing", no_data: "Data currently unavailable.", download_material: "Download Material", status_open: "Open", status_closed: "Closed" },
                    es: { header_lcm_full: "Laboratorio de Ciencias Militares", header_eceme_full: "Escuela de Comando y Estado Mayor del Ejército", nav_home: "Inicio", nav_research: "Líneas de Investigación", nav_all_researchers: "Investigadores", nav_theses: "Tesis y Disertaciones", nav_all_publications: "Publicaciones", nav_contact: "Contacto", nav_courses: "Cursos y Eventos", all_researchers_subtitle: "Investigadores del LCM divididos por subárea", theses_subtitle: "Repositorio académico del LCM", all_pubs_subtitle: "Archivo completo de publicaciones del LCM", news_label: "Destacado", leadership_title: "Coordinación LCM", coord_role: "Coordinador General", sub_a_role: "Coordinador de Línea de Inv. GD", sub_b_role: "Coordinador de Línea de Inv. EPG", line_a_label: "Línea A — Gestión de Defensa", line_b_label: "Línea B — Estudios de Paz y Guerra", structure_title: "Estructura de Investigación", structure_subtitle: "Seleccione una subárea para detalles", access_area: "ACCEDER ÁREA", back_research: "Volver a Líneas de Investigación", tab_about: "Sobre el Área", tab_researchers: "Investigadores", tab_projects: "Proyectos", tab_publications: "Publicaciones", label_focus: "Enfoque Estratégico", label_topics: "Temas Abarcados", label_tech: "Tecnologías Transversales", contact_title: "Contáctenos", contact_info: "Información de Contacto", contact_map: "Ubicación", contact_button: "Ver Ruta", courses_title: "Cursos y Eventos", courses_subtitle: "Siga nuestra agenda académica", search_placeholder: "Buscar...", no_results: "Ningún resultado encontrado.", col_project: "Proyecto", col_responsible: "Responsable", col_status: "Estado", status_ongoing: "En Curso", no_data: "Datos no disponibles.", download_material: "Descargar Material", status_open: "Abierto", status_closed: "Cerrado" }
                },

                initApp() {
                    this.loadNews();
                    this.loadEvents();
                    this.loadResearchers();
                    this.loadProjects();
                    this.loadPublications();
                    this.loadTheses(); 
                    setInterval(() => { this.nextSlide(); }, 6000);
                },

                async loadNews() { try { const res = await fetch('./data_news.json?v=' + new Date().getTime()); this.news = await res.json(); } catch (e) { console.error("Erro notícias", e); } },
                async loadEvents() { try { const res = await fetch('./data_events.json?v=' + new Date().getTime()); this.courses = await res.json(); } catch (e) { console.error("Erro eventos", e); } },
                async loadResearchers() { try { const res = await fetch('./data_researchers.json?v=' + new Date().getTime()); const data = await res.json(); data.forEach(item => { const area = this.subareas.find(s => s.id === item.subarea_id); if (area) area.researchers.push(item); }); } catch (e) { console.error("Erro pesquisadores", e); } },
                async loadProjects() { try { const res = await fetch('./data_projects.json?v=' + new Date().getTime()); const data = await res.json(); data.forEach(item => { const area = this.subareas.find(s => s.id === item.subarea_id); if (area) area.ongoing.push(item); }); } catch (e) { console.error("Erro projetos", e); } },
                async loadTheses() { try { const res = await fetch('./data_theses.json?v=' + new Date().getTime()); this.theses = await res.json(); } catch (e) { console.error("Erro teses", e); } },
                
                // CARREGAMENTO DE PUBLICAÇÕES
                async loadPublications() { 
                    try { 
                        const res = await fetch('./data_publications.json?v=' + new Date().getTime()); 
                        const data = await res.json();
                        
                        this.all_raw_publications = data; // Popula a variável global
                        
                        // Popula as subáreas individuais
                        data.forEach(item => {
                            const area = this.subareas.find(s => s.id == item.subarea_id); // Usa == para garantir compatibilidade
                            if (area) area.publications.push(item);
                        });
                    } catch (e) { console.error("Erro publicações", e); } 
                },

                // FUNÇÃO DE AGRUPAMENTO (CORRIGIDA COM ==)
                getStructuredPublications(subareaId) {
                    // Garante que a lista não é nula
                    if (!this.all_raw_publications) return [];
                    
                    // Filtra usando == para aceitar tanto string quanto number
                    const filtered = this.all_raw_publications.filter(p => p.subarea_id == subareaId);
                    
                    const years = [...new Set(filtered.map(item => item.year))].sort((a, b) => b - a);
                    
                    return years.map(year => {
                        return {
                            year: year,
                            docs: filtered.filter(item => item.year === year)
                        };
                    });
                },

                getStructuredTheses(type) {
                    const filtered = this.theses.filter(t => t.type === type);
                    const years = [...new Set(filtered.map(item => item.year))].sort((a, b) => b - a);
                    return years.map(year => {
                        return { year: year, docs: filtered.filter(item => item.year === year) };
                    });
                },

                nextSlide() { this.activeSlide = (this.activeSlide === this.news.length - 1) ? 0 : this.activeSlide + 1; },
                prevSlide() { this.activeSlide = (this.activeSlide === 0) ? this.news.length - 1 : this.activeSlide - 1; },
                get searchResults() {
                    if (this.searchQuery === '') return [];
                    const q = this.searchQuery.toLowerCase();
                    return this.subareas.filter(area => {
                        const title = area.title[this.lang].toLowerCase();
                        const focus = area.focus[this.lang].toLowerCase();
                        return title.includes(q) || focus.includes(q);
                    });
                },
                getInitials(name) { return name.match(/(\b\S)?/g).join("").match(/(^\S|\S$)?/g).join("").toUpperCase(); },
                openSubarea(area) {
                    this.activeArea = area;
                    this.view = 'subarea';
                    this.tab = 'sobre';
                    window.scrollTo(0, 0);
                }
            }
        }
    </script>
</body>
</html>

